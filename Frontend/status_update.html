<!DOCTYPE.html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Planning Application Status Modification</title>
	<link rel="icon" type="image/x-icon" href="signWorks_logo.png">
</head>
<body style="font-family: Arial; background-color: #F5F5DC;">
	<h1 style="background-color: #ADD8E6;">Update Planning Application Status Details</h1>
	
	<form id="editForm">
		<label for="job_no"><b>Job No:</b></label>
		<input type="text" id="job_no"><br><br>
		
		<label for="client"><b>Client:</b></label>
		<input type="text" id="client"><br><br>
		
		<label for="city"><b>City:</b></label>
		<input type="text" id="city"><br><br>
		
		<label for="date_submitted"><b>Date Submitted:</b></label>
		<input type="date" id="date_submitted"><br><br>
		
		<label for="status"><b>Status:</b></label>
		<select id="status">
			<option value="Not Submitted">Not Submitted</option>
			<option value="Pending">Pending</option>
			<option value="Approved">Approved</option>
		</select><br><br>
		
		<label for="date_approved"><b>Date Approved:</b></label>
		<input type="date" id="date_approved"><br><br>
		
		<button type="submit">Update</button>
		
<script>
// Retrieve selected job details from local storage
const selectedJob = JSON.parse(localStorage.getItem('selectedJob'));

//Fill form fields with selected job Details
document.getElementById('job_no').value = selectedJob.job_no;
document.getElementById('client').value = selectedJob.client;
document.getElementById('city').value = selectedJob.city;
document.getElementById('date_submitted').value = selectedJob.date_submitted;
document.getElementById('status').value = selectedJob.status;
document.getElementById('date_approved').value = selectedJob.date_approved;

//Handle form submission
document.getElementById('editForm').addEventListener('submit', async function(event) {
	event.preventDefault(); //Prevent default form submission
	
	const jobNo = document.getElementById('job_no').value;
	const Client = document.getElementById('client').value;
	const City = document.getElementById('city').value;
	const dateSubmitted = document.getElementById('date_submitted').value;
	const Status = document.getElementById('status').value;
	let dateApproved = document.getElementById('date_approved').value;
	
	if (dateApproved.trim() === '') {
		dateApproved = null;
	}
	else {
		dateApproved = new Date(dateApproved).toISOString().split('T')[0];
	}
	
	const data = {
		job_no: jobNo,
		client: Client,
		city: City,
		date_submitted: dateSubmitted,
		status: Status,
		date_approved: dateApproved
	};
	
	try {
		const response = await fetch('http://3.15.180.127:8000/sign_works/status_update/' + jobNo + '/', {
			method: 'PUT',
			headers: {
				'Content-Type': 'application/json'
			},
			body: JSON.stringify(data)
		});
		
		if (!response.ok) {
			throw new Error('Failed to update plan status details.');
		}
		
		// Redirect user back to Plan Staus page after successful Update
		window.location.href = 'view_status.html';
		
		const responseData = await response.json();
		alert('Plan status updated successfully!');
	} catch (error) {
		console.error('Error:', error);
		alert('Failed to update plan status. Please try again.');
	}
});

</script>
</body>
</html>
	
	
		
		
