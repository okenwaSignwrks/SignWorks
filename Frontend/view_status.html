<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Plan Status</title>
	<link rel="icon" type="image/x-icon" href="signWorks_logo.png">
</head>
<body style="font-family: arial">

<h1 style="background-color: #87CEFA;;">Planning Application Status</h1>

<input type="text" id="searchInput" oninput="filterTable()" onkeyup="handleKeyPress(event)" placeholder="Search...">

<table style="width:100%" border=2 id="statusTable">
<thead>
	<tr>
		<th style="background-color: yellow;">Job No.</th>
		<th style="background-color: yellow;">Client</th>
		<th style="background-color: yellow;">City</th>
		<th style="background-color: yellow;">Date Submitted</th>
		<th style="background-color: yellow;">Planning Department</th>
		<th style="background-color: yellow;">Status</th>
		<th style="background-color: yellow;">Date Approved</th>
	</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<script>

async function fetchData()
{
	try
	{
		const response = await fetch("http://3.15.180.127:8000/sign_works/plan_status_view/");
		const responseData = await response.json();
		
		//Update table with fetched data
		const tableBody = document.getElementById('tableBody');
		responseData.forEach(status =>
		{
			const row = document.createElement('tr');
			row.addEventListener('click', function()
			{
				selectJob(status);
			});
			//const row = statusTable.insertRow(-1);
			row.insertCell(0).textContent = status.job_no;
			row.insertCell(1).textContent = status.client;
			row.insertCell(2).textContent = status.city;
			row.insertCell(3).textContent = status.date_submitted;
			row.insertCell(4).textContent = status.planning_dept
			row.insertCell(5).textContent = status.status;
			row.insertCell(6).textContent = status.date_approved;
			tableBody.appendChild(row);
		});
	}
	catch (error)
	{
		console.log('Error retrieving data:', error);
	}
}

function filterTable()
{
	const input = document.getElementById('searchInput');
	const filter = input.value.toUpperCase();
	const table = document.getElementById('statusTable');
	const rows = table.getElementsByTagName('tr');
	
	for (let i = 1; i < rows.length; i++)
	{
		const cells = rows[i].getElementsByTagName('td');
		let shouldShowRow = false;
		
		for (let j = 0; j < cells.length; j++)
		{
			const cellText = cells[j].textContent || cells[j].innerText;
			
			if (cellText.toUpperCase().indexOf(filter) > -1)
			{
				shouldShowRow = true;
				break;
			}
		}
		
		rows[i].style.display = shouldShowRow ? '' : 'none';
	}
}

function handleKeyPress(event)
{
	if (event.key == 'Enter')
	{
		filterTable();
	}
}


function selectJob(job)
{
	localStorage.setItem('selectedJob', JSON.stringify(job));
	window.location.href = 'status_details.html';
}


fetchData();

		
//Add a reload capability that leads to this page after submitting a job

</script>
</body>
</html>
			
		
		
		
		
